---
title: lua模块定义
comments: true
date: 2018-12-11 11:45:30
tags:
- lua
categories:
- lua
---

lua5.1中提供的module方法在lua5.3中已经放弃使用，推荐使用的模块儿定义方式如下

1. require table 方式定义模块


```
-- square.lua
local _M = {}           -- 局部的变量
_M._VERSION = '1.0'     -- 模块版本

local mt = { __index = _M }

function _M.new(self, width, height)
    return setmetatable({ width=width, height=height }, mt)
end

function _M.get_square(self)
    return self.width * self.height
end

function _M.get_circumference(self)
    return (self.width + self.height) * 2
end

return _M
引用示例代码：
local square = require "square" 

local s1 = square:new(1, 2)
print(s1:get_square())          --output: 2
print(s1:get_circumference())   --output: 6
```

2. module 方式定义模块
```
module （“moduleA”) 

--相当于执行如下代码
local name = “moduleA”        
local M = {}                               
_G[name] = M                        
package.loaded[modname] = M      
setfenv(1,M)  --设置一个函数的环境当第一个参数为一个数字时，为1代表当前函数



module (..., package.seeall)  
t = {}  
function f()  
 --todo  
end
```

module会导致当前环境压栈，module之后全局变量都不在可见。