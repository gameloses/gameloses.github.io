---
title: lua类的实现
comments: true
date: 2018-12-11 18:10:12
tags:
- lua
categories:
- lua
---

子类在定义时复制所有基类的方法，在实例化时将该类作为metatable的__index赋值给实例。这就是cocos2dx里面的lua class的实现。

```
function class(classname, super)
​     local cls = {}
​     if super then --复制基类方法
​        cls = {}
​        for k,v in pairs(super) do cls[k] = v end
​        cls.super = super
​    else
​        cls = {ctor = function() end}
​    end

​    cls.__cname = classname
​    cls.__index = cls

​    function cls.new(...) --实例化
​        local instance = setmetatable({}, cls)
​        instance.class = cls
​        instance:ctor(...)
​        return instance
​    end
​    return cls
end
```



